<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order Invoice | Wilson Health Care</title>
    <link rel="icon" type="image/jpg" href="logo.jpg">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #059669;
            --primary-dark: #047857;
            --secondary: #134e4a;
            --text-main: #1e293b;
            --text-light: #64748b;
            --bg-light: #f0fdf4;
            --border: #d1fae5;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Outfit', sans-serif;
            background: var(--bg-light);
            color: var(--text-main);
            padding: 2rem;
            display: flex;
            justify-content: center;
            min-height: 100vh;
        }

        .invoice-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 16px;
            width: 100%;
            max-width: 820px;
        }

        .action-bar {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            justify-content: center;
            width: 100%;
        }

        .btn {
            padding: 10px 22px;
            border: none;
            border-radius: 8px;
            font-family: 'Outfit', sans-serif;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
            text-decoration: none;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn-print {
            background: var(--secondary);
            color: white;
        }

        .btn-whatsapp {
            background: #25d366;
            color: white;
        }

        .btn-cancel {
            background: #fee2e2;
            color: #ef4444;
            border: 1px solid #fca5a5;
        }

        .btn-home {
            background: #f1f5f9;
            color: var(--secondary);
        }

        .invoice-container {
            background: white;
            width: 100%;
            padding: 3rem;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.07);
            border: 1px solid var(--border);
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 2rem;
            border-bottom: 3px solid var(--primary);
            padding-bottom: 1.5rem;
            gap: 20px;
        }

        .logo-area {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-area img {
            width: 65px;
            height: 65px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--primary);
        }

        .company-info h1 {
            color: var(--primary);
            font-size: 1.7rem;
            margin-bottom: 4px;
        }

        .company-info p {
            font-size: 0.85rem;
            color: var(--text-light);
            line-height: 1.6;
        }

        .invoice-title {
            text-align: right;
        }

        .invoice-title h2 {
            font-size: 1.6rem;
            color: var(--secondary);
            margin-bottom: 6px;
            letter-spacing: 1px;
        }

        .status-badge {
            display: inline-block;
            padding: 5px 14px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            margin-bottom: 8px;
            letter-spacing: 0.5px;
        }

        .badge-placed {
            background: #fef3c7;
            color: #b45309;
            border: 1px solid #fcd34d;
        }

        .badge-confirmed {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #6ee7b7;
        }

        .badge-cancelled {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fca5a5;
        }

        .badge-dispatched {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #93c5fd;
        }

        .invoice-meta {
            font-size: 0.88rem;
            color: var(--text-light);
            line-height: 1.7;
        }

        .invoice-meta strong {
            color: var(--text-main);
        }

        .billing-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 1.5rem;
            padding: 1.2rem;
            background: var(--bg-light);
            border-radius: 10px;
            border: 1px solid var(--border);
        }

        .bill-section h3 {
            font-size: 0.78rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .bill-section p {
            font-size: 0.88rem;
            color: var(--text-main);
            line-height: 1.7;
        }

        .notice-box {
            background: #fffbeb;
            border: 1px solid #fcd34d;
            border-left: 4px solid #f59e0b;
            border-radius: 8px;
            padding: 12px 16px;
            margin-bottom: 1.5rem;
            font-size: 0.85rem;
            color: #78350f;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .notice-box i {
            margin-top: 3px;
            color: #f59e0b;
            flex-shrink: 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 1.5rem;
        }

        th {
            background: var(--secondary);
            color: white;
            padding: 11px 14px;
            text-align: left;
            font-weight: 600;
            font-size: 0.82rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        th:last-child {
            text-align: right;
        }

        td {
            padding: 12px 14px;
            border-bottom: 1px solid #f1f5f9;
            font-size: 0.9rem;
        }

        td:last-child {
            text-align: right;
            font-weight: 700;
        }

        tbody tr:hover {
            background: var(--bg-light);
        }

        .total-section {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 2rem;
        }

        .total-box {
            width: 300px;
        }

        .total-row {
            display: flex;
            justify-content: space-between;
            padding: 7px 0;
            font-size: 0.9rem;
            border-bottom: 1px solid #f1f5f9;
        }

        .total-row .lbl {
            color: var(--text-light);
        }

        .grand-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0 0;
            font-weight: 800;
            font-size: 1.15rem;
            color: var(--primary);
        }

        .invoice-footer {
            border-top: 1px dashed var(--border);
            padding-top: 1.2rem;
            text-align: center;
            font-size: 0.8rem;
            color: var(--text-light);
            line-height: 1.9;
        }

        .invoice-footer strong {
            color: var(--secondary);
        }

        @media print {
            body {
                background: white;
                padding: 0;
            }

            .invoice-container {
                box-shadow: none;
                border: none;
                padding: 20px;
                border-radius: 0;
            }

            .action-bar {
                display: none !important;
            }
        }

        @media (max-width: 640px) {
            body {
                padding: 1rem;
            }

            .invoice-container {
                padding: 1.5rem;
            }

            .header {
                flex-direction: column;
            }

            .invoice-title {
                text-align: left;
            }

            .billing-info {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
        }
    </style>
</head>

<body>
    <div class="invoice-wrapper">

        <div class="action-bar">
            <button class="btn btn-print" onclick="window.print()">
                <i class="fas fa-print"></i> Print / Save PDF
            </button>
            <button class="btn btn-whatsapp" onclick="contactWhatsApp()">
                <i class="fab fa-whatsapp"></i> Contact on WhatsApp
            </button>
            <button class="btn btn-cancel" id="cancel-btn" onclick="cancelOrder()" style="display:none;">
                <i class="fas fa-ban"></i> Cancel Order
            </button>
            <a href="index.html" class="btn btn-home">
                <i class="fas fa-home"></i> Back to Home
            </a>
        </div>

        <div class="invoice-container" id="invoice">
            <div style="text-align:center;padding:3rem;color:var(--text-light);">
                <i class="fas fa-spinner fa-spin" style="font-size:2rem;margin-bottom:1rem;display:block;"></i>
                Loading Order Details...
            </div>
        </div>

    </div>

    <script>
        let currentOrder = null;

        function loadInvoice() {
            const params = new URLSearchParams(window.location.search);
            const orderId = params.get('id');
            const orders = JSON.parse(localStorage.getItem('wilson-orders')) || [];
            currentOrder = orders.find(o => o.orderId === orderId);
            const box = document.getElementById('invoice');

            if (!currentOrder) {
                box.innerHTML = `
                    <div style="text-align:center;padding:3rem;">
                        <i class="fas fa-exclamation-triangle" style="font-size:3rem;color:#ef4444;margin-bottom:1rem;display:block;"></i>
                        <h2 style="margin-bottom:10px;">Order Not Found</h2>
                        <p style="color:var(--text-light);margin-bottom:1rem;">The requested order could not be found.</p>
                        <a href="index.html" style="color:var(--primary);font-weight:600;">← Return to Home</a>
                    </div>`;
                return;
            }

            // Status badge
            const s = currentOrder.status || 'Placed';
            const badges = {
                Placed: 'badge-placed',
                Confirmed: 'badge-confirmed',
                Cancelled: 'badge-cancelled',
                Dispatched: 'badge-dispatched'
            };
            const badgeClass = badges[s] || 'badge-placed';

            const subtotal = currentOrder.items.reduce((t, i) => t + i.price * i.quantity, 0);
            const totalTax = currentOrder.items.reduce((t, i) => t + i.price * i.quantity * (i.gst || 0) / 100, 0);
            const grand = currentOrder.total || (subtotal + totalTax);

            box.innerHTML = `
                <div class="header">
                    <div class="logo-area">
                        <img src="logo.jpg" alt="Wilson Logo" onerror="this.src='https://via.placeholder.com/65'">
                        <div class="company-info">
                            <h1>WILSON HEALTH CARE</h1>
                            <p>Premium Medical Equipment Provider</p>
                            <p>Uppal, Hyderabad, Telangana — 500039</p>
                            <p>📞 +91 70326 87122 &nbsp;|&nbsp; ✉️ wilsonhealthcare7@gmail.com</p>
                        </div>
                    </div>
                    <div class="invoice-title">
                        <div class="status-badge ${badgeClass}">${s.toUpperCase()}</div>
                        <h2>ORDER INVOICE</h2>
                        <div class="invoice-meta">
                            <p><strong>Order ID:</strong> ${currentOrder.orderId}</p>
                            <p><strong>Date:</strong> ${new Date(currentOrder.date).toLocaleDateString('en-IN', { day: '2-digit', month: 'long', year: 'numeric' })}</p>
                            <p><strong>Time:</strong> ${new Date(currentOrder.date).toLocaleTimeString('en-IN')}</p>
                        </div>
                    </div>
                </div>

                <div class="billing-info">
                    <div class="bill-section">
                        <h3>Customer Details</h3>
                        <p><strong>${currentOrder.customer?.name || 'Customer'}</strong></p>
                        <p>${currentOrder.customer?.mobile || ''}</p>
                        <p>${currentOrder.customer?.email || ''}</p>
                    </div>
                    <div class="bill-section">
                        <h3>Delivery Address</h3>
                        ${getAddress(currentOrder.customer)}
                    </div>
                </div>

                <div class="notice-box">
                    <i class="fas fa-truck"></i>
                    <div>Our team will contact you to <strong>confirm your order and arrange delivery</strong>.
                    Payment is collected at the time of delivery. 
                    For queries: <strong>+91 70326 87122</strong>.</div>
                </div>

                <table>
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Item</th>
                            <th>Qty</th>
                            <th>Unit Price</th>
                            <th>GST</th>
                            <th>Amount</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${currentOrder.items.map((item, i) => `
                        <tr>
                            <td>${i + 1}</td>
                            <td>${item.name}</td>
                            <td>${item.quantity}</td>
                            <td>₹${item.price.toLocaleString('en-IN')}</td>
                            <td>${item.gst || 0}%</td>
                            <td>₹${(item.price * item.quantity * (1 + (item.gst || 0) / 100)).toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</td>
                        </tr>`).join('')}
                    </tbody>
                </table>

                <div class="total-section">
                    <div class="total-box">
                        <div class="total-row">
                            <span class="lbl">Subtotal (excl. GST):</span>
                            <span>₹${subtotal.toLocaleString('en-IN', { minimumFractionDigits: 2 })}</span>
                        </div>
                        <div class="total-row">
                            <span class="lbl">Total GST:</span>
                            <span>₹${totalTax.toLocaleString('en-IN', { minimumFractionDigits: 2 })}</span>
                        </div>
                        <div class="grand-row">
                            <span>Grand Total:</span>
                            <span>₹${grand.toLocaleString('en-IN', { minimumFractionDigits: 2 })}</span>
                        </div>
                    </div>
                </div>

                <div class="invoice-footer">
                    <p>Thank you for choosing <strong>Wilson Health Care</strong>!</p>
                    <p>This is a system-generated order summary. <strong>Payment is collected on delivery.</strong></p>
                    <p>Support: <strong>+91 70326 87122</strong> &nbsp;|&nbsp; <strong>wilsonhealthcare7@gmail.com</strong></p>
                </div>`;

            if (s !== 'Cancelled') document.getElementById('cancel-btn').style.display = 'flex';
        }

        function getAddress(c) {
            if (!c) return '<p style="color:#ef4444;font-size:0.85rem;">(No address provided)</p>';
            const parts = [
                c.hno ? 'H.No: ' + c.hno : '',
                c.street,
                c.landmark ? 'Near: ' + c.landmark : '',
                c.district, c.state,
                c.pincode ? 'PIN: ' + c.pincode : ''
            ].filter(Boolean);
            return parts.length
                ? `<p style="line-height:1.7;">${parts.join(', ')}</p>`
                : '<p style="color:#ef4444;font-size:0.85rem;">(No address provided)</p>';
        }

        function cancelOrder() {
            if (!currentOrder || !confirm('Cancel this order?')) return;
            const orders = JSON.parse(localStorage.getItem('wilson-orders')) || [];
            const idx = orders.findIndex(o => o.orderId === currentOrder.orderId);
            if (idx > -1) {
                orders[idx].status = 'Cancelled';
                localStorage.setItem('wilson-orders', JSON.stringify(orders));
                loadInvoice();
            }
        }

        function contactWhatsApp() {
            if (!currentOrder) return;
            const lines = currentOrder.items.map(i => `• ${i.name} × ${i.quantity}`).join('\n');
            const msg = `Hi Wilson Health Care,\n\nOrder ID: ${currentOrder.orderId}\n\nItems:\n${lines}\n\nGrand Total: ₹${(currentOrder.total || 0).toLocaleString('en-IN')}\n\nPlease confirm my order. Thank you!`;
            window.open('https://wa.me/917032687122?text=' + encodeURIComponent(msg), '_blank');
        }

        window.onload = loadInvoice;
    </script>
</body>

</html>